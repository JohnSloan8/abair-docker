import{a as s,V as o,j as r}from"./setPrototypeOf.fd4aa278.js";import{s as C,p as H,ao as $,av as Y,aw as j,aa as U,c as V,u as E,ax as N,H as q,B as p,A as J,C as T,G as h,ab as K,ap as v,ay as x,az as b,aA as y,ac as O,T as P,aB as Q,v as R,aC as X,L as Z,aD as ee,ae as re}from"./App.51d4e149.js";import{M as ae}from"./Meta.ee4315c5.js";import"./index.1aa9bee6.js";import"./index.module.01fcbc19.js";const le=async l=>{console.log("profile:",l);try{const{data:t,error:d}=await C.from("profiles").upsert({id:l.id,username:l.username,dialect:l.dialect,gender:l.gender,year:l.year}).select().single();if(d)throw d;return t}catch(t){alert(t.message)}},te=async()=>{console.log("in getDialects");try{const{data:l,error:t}=await C.from("dialects").select("*");if(t){console.log("error:",t);return}else return l}catch(l){alert(l.message)}},ie=async()=>{try{const{data:l,error:t}=await C.from("genders").select("*");if(t){console.log("error:",t);return}else return l}catch(l){alert(l.message)}};function ue(){const[l,t]=s.exports.useState(!0),[d,S]=s.exports.useState(""),[F,w]=s.exports.useState(null),[G,k]=s.exports.useState(null),[M,L]=s.exports.useState(null),[W,B]=s.exports.useState(!1),{session:c}=H(),{profile:a,setProfile:u}=$(),{dialects:g,setDialects:_}=Y(),{genders:m,setGenders:z}=j(),[I]=s.exports.useState(Array.from({length:100},(e,n)=>1923+n)),[f]=U(),D=V(),{t:i}=E();s.exports.useEffect(()=>{c?N(c).then(e=>{e!==void 0&&e.length!==0?(u(e[0]),e[0].dialect&&k(e[0].dialect),e[0].gender&&L(e[0].gender),e[0].year&&w(e[0].year),e[0].username&&S(e[0].username)):console.log("no profile")}):f.get("origin")!==null?D(`/login?origin=${f.get("origin")}`):D("/login"),g===void 0&&te().then(e=>{e!==void 0&&_(e)}),m===void 0&&ie().then(e=>{e!==void 0&&z(e)})},[]),s.exports.useEffect(()=>{m!==void 0&&g!==void 0&&a!==void 0&&(t(!1),console.log("profile:",a))},[m,g,a]);const A=async()=>{c!==null&&a!==null?(t(!0),le(a).then(()=>{t(!1),f.get("origin")?window.location.href=`${re}/${f.get("origin")}`:B(!0)})):alert("not logged in")};return o(q,{children:[o(p,{sx:{maxWidth:"sm",width:"100%"},children:[r(ae,{title:"Profile & Consent"}),r(p,{py:{sm:4,xs:2},children:r(J,{title:i("infoHeader.home.profile.title"),description:i("infoHeader.home.profile.description")})}),r(T,{m:2,children:r(p,{children:l?"Loading...":c?o(p,{width:360,children:[o(h,{container:!0,spacing:0,children:[r(h,{item:!0,xs:12,my:1,children:r(K,{fullWidth:!0,id:"username",label:i("pages.profile.username"),name:"username",placeholder:i("pages.profile.username"),value:a!==null&&a.username!==void 0&&a.username!==null?a.username:"",onChange:e=>{S(e.target.value),u(n=>({...n,username:e.target.value}))},helperText:d.length!==0&&d.length<3?i("pages.profile.minimumThreeLetters"):""})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:i("pages.profile.birthYear")}),r(b,{labelId:"birth year",id:"birth year",value:a!==null&&a.year!==void 0&&a.year!==null?a.year:"",label:i("pages.profile.birthYear"),onChange:e=>{w(e.target.value),u(n=>({...n,year:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:I?I.map(e=>r(y,{value:e,children:e},e)):""})]})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:i("pages.profile.dialect")}),r(b,{labelId:"dialect",id:"dialect",value:a!==null&&a.dialect!==void 0&&a.dialect!==null?a.dialect:"",label:i("pages.profile.dialect"),onChange:e=>{k(e.target.value),u(n=>({...n,dialect:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:g?g.map(e=>r(y,{value:e.id,children:e.name},e.id)):""})]})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:i("pages.profile.gender")}),r(b,{labelId:"gender",id:"gender",value:a!==null&&a.gender!==void 0&&a.gender!==null?a.gender:"",label:"gender",onChange:e=>{L(e.target.value),u(n=>({...n,gender:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:m?m.map(e=>r(y,{value:e.id,children:e.name},e.id)):null})]})})]}),r(T,{sx:{width:"100%"},children:r(O,{onClick:A,variant:"contained",sx:{mt:3,mb:2},disabled:l||d.length<3||F===null||M===null||G===null,children:"Save profile"})}),a!==null&&a.over_16===!1&&o(p,{mt:2,children:[r(P,{fontWeight:"bold",align:"center",children:"Parent/Caregiver Details:"}),r(P,{align:"center",children:`name: ${a.parent_caregiver_name}`}),r(P,{align:"center",children:`email: ${a.parent_caregiver_email}`})]})]}):r("p",{children:"not logged in"})})})]}),W&&r(Q,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:c?r(R,{title:i("pages.profile.updated"),description:i("pages.profile.thanks"),condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{B(!1)}}):r(X,{component:Z,to:"/login",size:"medium",edge:"end",sx:{color:"primary.main"},"aria-label":"log in",children:r(ee,{})})})]})}export{ue as default};
