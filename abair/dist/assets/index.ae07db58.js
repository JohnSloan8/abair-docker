import{_ as x,X as I,a as c,L as N,j as s,V as p}from"./setPrototypeOf.fd4aa278.js";import{P as z,O as H,Q as j,a0 as A,ag as E,au as T,av as R,R as Y,aw as V,ax as X,W as q,X as L,Y as Q,s as P,p as J,aa as K,c as Z,H as ee,B as b,A as ae,C as U,G as y,ab as te,ao as w,ay as B,az as O,ac as se,T as S,aA as re,v as ie,ae as oe}from"./App.d49615af.js";import{M as ne}from"./Meta.671df0b2.js";import{u as le,a as de,b as ce}from"./index.b41b301b.js";import{d as W}from"./dividerClasses.fff5b1cc.js";import"./index.c665bf1b.js";import"./index.module.01fcbc19.js";function ue(e){return H("MuiMenuItem",e)}const pe=z("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),h=pe,ge=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],me=(e,t)=>{const{ownerState:i}=e;return[t.root,i.dense&&t.dense,i.divider&&t.divider,!i.disableGutters&&t.gutters]},fe=e=>{const{disabled:t,dense:i,divider:o,disableGutters:d,selected:r,classes:l}=e,g=Q({root:["root",i&&"dense",t&&"disabled",!d&&"gutters",o&&"divider",r&&"selected"]},ue,l);return x({},l,g)},ve=j(A,{shouldForwardProp:e=>E(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:me})(({theme:e,ownerState:t})=>x({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${h.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:I(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${h.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:I(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${h.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:I(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:I(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${h.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${h.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${W.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${W.inset}`]:{marginLeft:52},[`& .${R.root}`]:{marginTop:0,marginBottom:0},[`& .${R.inset}`]:{paddingLeft:36},[`& .${T.root}`]:{minWidth:36}},!t.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},t.dense&&x({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${T.root} svg`]:{fontSize:"1.25rem"}}))),be=c.exports.forwardRef(function(t,i){const o=Y({props:t,name:"MuiMenuItem"}),{autoFocus:d=!1,component:r="li",dense:l=!1,divider:u=!1,disableGutters:g=!1,focusVisibleClassName:m,role:M="menuitem",tabIndex:v,className:f}=o,C=N(o,ge),$=c.exports.useContext(V),a=c.exports.useMemo(()=>({dense:l||$.dense||!1,disableGutters:g}),[$.dense,l,g]),n=c.exports.useRef(null);X(()=>{d&&n.current&&n.current.focus()},[d]);const _=x({},o,{dense:a.dense,divider:u,disableGutters:g}),k=fe(o),D=q(n,i);let G;return o.disabled||(G=v!==void 0?v:-1),s(V.Provider,{value:a,children:s(ve,x({ref:D,role:M,tabIndex:G,component:r,focusVisibleClassName:L(k.focusVisible,m),className:L(k.root,f)},C,{ownerState:_,classes:k}))})}),F=be,ye=async e=>{try{const{user:t}=e,{data:i,error:o}=await P.from("profiles").select("*").eq("id",t.id);if(o){console.log("error:",o);return}else return i}catch(t){alert(t.message)}},he=async e=>{console.log("profile:",e);try{const{data:t,error:i}=await P.from("profiles").upsert({id:e.id,username:e.username,dialect:e.dialect,gender:e.gender,year:e.year}).select().single();if(i)throw i;return t}catch(t){alert(t.message)}},xe=async()=>{console.log("in getDialects");try{const{data:e,error:t}=await P.from("dialects").select("*");if(t){console.log("error:",t);return}else return e}catch(e){alert(e.message)}},Ce=async()=>{try{const{data:e,error:t}=await P.from("genders").select("*");if(t){console.log("error:",t);return}else return e}catch(e){alert(e.message)}};function Oe(){const[e,t]=c.exports.useState(!0),[i,o]=c.exports.useState(!1),{session:d}=J(),{profile:r,setProfile:l}=le(),{dialects:u,setDialects:g}=de(),{genders:m,setGenders:M}=ce(),[v]=c.exports.useState(Array.from({length:100},(a,n)=>1923+n)),[f]=K(),C=Z();c.exports.useEffect(()=>{d?ye(d).then(a=>{a!==void 0&&a.length!==0?l(a[0]):console.log("no profile")}):f.get("origin")!==null?C(`/login?origin=${f.get("origin")}`):C("/login"),u===void 0&&xe().then(a=>{a!==void 0&&g(a)}),m===void 0&&Ce().then(a=>{a!==void 0&&M(a)})},[]),c.exports.useEffect(()=>{m!==void 0&&u!==void 0&&r!==void 0&&t(!1)},[m,u,r]);const $=async()=>{d!==null?(t(!0),he(r).then(()=>{t(!1),f.get("origin")?window.location.href=`${oe}/${f.get("origin")}`:o(!0)})):alert("not logged in")};return p(ee,{children:[p(b,{sx:{maxWidth:"sm",width:"100%"},children:[s(ne,{title:"Profile & Consent"}),s(b,{py:{sm:4,xs:2},children:s(ae,{title:"Profile"})}),s(U,{m:2,children:s(b,{children:e?"Loading...":d?p(b,{children:[p(y,{container:!0,spacing:0,children:[s(y,{item:!0,xs:12,my:1,children:s(te,{fullWidth:!0,id:"username",label:"Username",name:"username",placeholder:"Your username",value:r.username!==void 0&&r.username!==null?r.username:"",onChange:a=>{l(n=>({...n,username:a.target.value}))}})}),s(y,{item:!0,xs:12,my:1,children:p(w,{fullWidth:!0,children:[s(B,{id:"demo-simple-select-label",children:"Birth Year"}),s(O,{labelId:"birth year",id:"birth year",value:r.year!==void 0&&r.year!==null?r.year:"",label:"dialect",onChange:a=>{l(n=>({...n,year:a.target.value}))},children:v?v.map(a=>s(F,{value:a,children:a},a)):""})]})}),s(y,{item:!0,xs:12,my:1,children:p(w,{fullWidth:!0,children:[s(B,{id:"demo-simple-select-label",children:"Dialect"}),s(O,{labelId:"dialect",id:"dialect",value:r.dialect!==void 0&&r.dialect!==null?r.dialect:"",label:"dialect",onChange:a=>{l(n=>({...n,dialect:a.target.value}))},children:u?u.map(a=>s(F,{value:a.id,children:a.name},a.id)):""})]})}),s(y,{item:!0,xs:12,my:1,children:p(w,{fullWidth:!0,children:[s(B,{id:"demo-simple-select-label",children:"Gender"}),s(O,{labelId:"gender",id:"gender",value:r.gender!==void 0&&r.gender!==null?r.gender:"",label:"gender",onChange:a=>{l(n=>({...n,gender:a.target.value}))},children:m?m.map(a=>s(F,{value:a.id,children:a.name},a.id)):null})]})})]}),s(U,{sx:{width:"100%"},children:s(se,{onClick:$,variant:"contained",sx:{mt:3,mb:2},disabled:e,children:"Update profile"})}),!r.over_16&&p(b,{mt:2,children:[s(S,{fontWeight:"bold",align:"center",children:"Parent/Caregiver Details:"}),s(S,{align:"center",children:`name: ${r.parent_caregiver_name}`}),s(S,{align:"center",children:`email: ${r.parent_caregiver_email}`})]})]}):s("p",{children:"not logged in"})})})]}),i&&s(re,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:s(ie,{title:"Profile Updated",description:"Thank you for providing this information :-)",condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{o(!1)}})})]})}export{Oe as default};
