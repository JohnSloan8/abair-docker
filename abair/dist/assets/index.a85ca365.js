import{a as s,V as o,j as r}from"./setPrototypeOf.fd4aa278.js";import{s as P,p as A,au as H,aw as Y,ax as j,ag as E,b as U,u as V,ay as N,H as q,B as m,A as J,C as T,G as h,ad as K,av as v,az as x,aA as b,aB as y,ah as O,T as C,aC as Q,v as R,aD as X,L as Z,aE as ee,ai as re}from"./App.c0561854.js";import{M as ae}from"./Meta.1f9bea5e.js";import"./index.547c9ddc.js";import"./index.module.01fcbc19.js";const le=async l=>{console.log("profile:",l);try{const{data:n,error:d}=await P.from("profiles").upsert({id:l.id,username:l.username,dialect:l.dialect,gender:l.gender,year:l.year}).select().single();if(d)throw d;return n}catch(n){alert(n.message)}},te=async()=>{console.log("in getDialects");try{const{data:l,error:n}=await P.from("dialects").select("*");if(n){console.log("error:",n);return}else return l}catch(l){alert(l.message)}},ie=async()=>{try{const{data:l,error:n}=await P.from("genders").select("*");if(n){console.log("error:",n);return}else return l}catch(l){alert(l.message)}};function ue(){const[l,n]=s.exports.useState(!0),[d,S]=s.exports.useState(""),[$,w]=s.exports.useState(null),[F,L]=s.exports.useState(null),[G,k]=s.exports.useState(null),[M,B]=s.exports.useState(!1),{session:c}=A(),{profile:a,setProfile:u}=H(),{dialects:g,setDialects:W}=Y(),{genders:p,setGenders:_}=j(),[I]=s.exports.useState(Array.from({length:100},(e,i)=>1923+i)),[f]=E(),D=U(),{t}=V();s.exports.useEffect(()=>{c?N(c).then(e=>{e!==void 0&&e.length!==0?(u(e[0]),e[0].dialect&&L(e[0].dialect),e[0].gender&&k(e[0].gender),e[0].year&&w(e[0].year),e[0].username&&S(e[0].username)):console.log("no profile")}):f.get("origin")!==null?D(`/login?origin=${f.get("origin")}`):D("/login"),g===void 0&&te().then(e=>{e!==void 0&&W(e)}),p===void 0&&ie().then(e=>{e!==void 0&&_(e)})},[]),s.exports.useEffect(()=>{p!==void 0&&g!==void 0&&a!==void 0&&(n(!1),console.log("profile:",a))},[p,g,a]);const z=async()=>{c!==null&&a!==null?(n(!0),le(a).then(()=>{n(!1),f.get("origin")?window.location.href=`${re}/${f.get("origin")}`:B(!0)})):alert("not logged in")};return o(q,{children:[o(m,{sx:{maxWidth:"sm",width:"100%"},children:[r(ae,{title:"Profile & Consent"}),r(m,{py:{sm:4,xs:2},children:r(J,{title:t("infoHeader.home.profile.title"),description:t("infoHeader.home.profile.description")})}),r(T,{m:2,children:r(m,{children:l?"Loading...":c?o(m,{width:360,children:[o(h,{container:!0,spacing:0,children:[r(h,{item:!0,xs:12,my:1,children:r(K,{fullWidth:!0,id:"username",label:t("pages.profile.username"),name:"username",placeholder:t("pages.profile.username"),value:a!==null&&a.username!==void 0&&a.username!==null?a.username:"",onChange:e=>{S(e.target.value),u(i=>({...i,username:e.target.value}))},helperText:d.length!==0&&d.length<3?t("pages.profile.minimumThreeLetters"):""})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:t("pages.profile.birthYear")}),r(b,{labelId:"birth year",id:"birth year",value:a!==null&&a.year!==void 0&&a.year!==null?a.year:"",label:t("pages.profile.birthYear"),onChange:e=>{w(e.target.value),u(i=>({...i,year:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:I?I.map(e=>r(y,{value:e,children:e},e)):""})]})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:t("pages.profile.dialect")}),r(b,{labelId:"dialect",id:"dialect",value:a!==null&&a.dialect!==void 0&&a.dialect!==null?a.dialect:"",label:t("pages.profile.dialect"),onChange:e=>{L(e.target.value),u(i=>({...i,dialect:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:g?g.map(e=>{var i;return r(y,{value:e.id,children:t(`pages.profile.${(i=e.name)==null?void 0:i.toLowerCase()}`)},e.id)}):""})]})}),r(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[r(x,{id:"demo-simple-select-label",children:t("pages.profile.gender")}),r(b,{labelId:"gender",id:"gender",value:a!==null&&a.gender!==void 0&&a.gender!==null?a.gender:"",label:"gender",onChange:e=>{k(e.target.value),u(i=>({...i,gender:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:p?p.map(e=>{var i;return r(y,{value:e.id,children:t(`pages.profile.${(i=e.name)==null?void 0:i.toLowerCase()}`)},e.id)}):null})]})})]}),r(T,{sx:{width:"100%"},children:r(O,{onClick:z,variant:"contained",sx:{mt:3,mb:2},disabled:l||d.length<3||$===null||G===null||F===null,children:t("pages.profile.save")})}),a!==null&&a.over_16===!1&&o(m,{mt:2,children:[r(C,{fontWeight:"bold",align:"center",children:"Parent/Caregiver Details:"}),r(C,{align:"center",children:`name: ${a.parent_caregiver_name}`}),r(C,{align:"center",children:`email: ${a.parent_caregiver_email}`})]})]}):r("p",{children:"not logged in"})})})]}),M&&r(Q,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:c?r(R,{title:t("pages.profile.updated"),description:t("pages.profile.thanks"),condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{B(!1)}}):r(X,{component:Z,to:"/login",size:"medium",edge:"end",sx:{color:"primary.main"},"aria-label":"log in",children:r(ee,{})})})]})}export{ue as default};
