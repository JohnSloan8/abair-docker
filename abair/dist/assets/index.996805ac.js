import{_ as y,X as x,a as u,L as H,j as s,V as m}from"./setPrototypeOf.fd4aa278.js";import{Q as z,P as E,R as Y,a1 as _,ag as A,ap as B,aq as O,U as q,ar as F,as as X,X as Q,Y as G,Z,s as C,p as J,ac as K,c as ee,af as S,H as ae,B as h,A as te,C as R,G as b,ad as U,aj as V,at as L,au as T,ae as se,v as re,w as oe}from"./App.6f9591d6.js";import{M as ie}from"./Meta.3ee40c2f.js";import{u as ne,a as le,b as de}from"./index.b41b301b.js";import{d as D}from"./dividerClasses.6c815bc8.js";import"./index.3161768b.js";import"./index.module.01fcbc19.js";function ce(e){return E("MuiMenuItem",e)}const ue=z("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),v=ue,pe=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],fe=(e,a)=>{const{ownerState:o}=e;return[a.root,o.dense&&a.dense,o.divider&&a.divider,!o.disableGutters&&a.gutters]},me=e=>{const{disabled:a,dense:o,divider:i,disableGutters:d,selected:r,classes:n}=e,p=Z({root:["root",o&&"dense",a&&"disabled",!d&&"gutters",i&&"divider",r&&"selected"]},ce,n);return y({},n,p)},ge=Y(_,{shouldForwardProp:e=>A(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:fe})(({theme:e,ownerState:a})=>y({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${v.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:x(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${v.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:x(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${v.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:x(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:x(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${v.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${v.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${D.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${D.inset}`]:{marginLeft:52},[`& .${O.root}`]:{marginTop:0,marginBottom:0},[`& .${O.inset}`]:{paddingLeft:36},[`& .${B.root}`]:{minWidth:36}},!a.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},a.dense&&y({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${B.root} svg`]:{fontSize:"1.25rem"}}))),be=u.exports.forwardRef(function(a,o){const i=q({props:a,name:"MuiMenuItem"}),{autoFocus:d=!1,component:r="li",dense:n=!1,divider:c=!1,disableGutters:p=!1,focusVisibleClassName:f,role:I="menuitem",tabIndex:g,className:$}=i,P=H(i,pe),t=u.exports.useContext(F),l=u.exports.useMemo(()=>({dense:n||t.dense||!1,disableGutters:p}),[t.dense,n,p]),M=u.exports.useRef(null);X(()=>{d&&M.current&&M.current.focus()},[d]);const W=y({},i,{dense:l.dense,divider:c,disableGutters:p}),k=me(i),j=Q(M,o);let w;return i.disabled||(w=g!==void 0?g:-1),s(F.Provider,{value:l,children:s(ge,y({ref:j,role:I,tabIndex:w,component:r,focusVisibleClassName:G(k.focusVisible,f),className:G(k.root,$)},P,{ownerState:W,classes:k}))})}),N=be,ve=async e=>{try{const{user:a}=e,{data:o,error:i}=await C.from("profiles").select("*").eq("id",a.id);if(i){console.log("error:",i);return}else return o}catch(a){alert(a.message)}},ye=async e=>{console.log("profile:",e);try{const{data:a,error:o}=await C.from("profiles").upsert({id:e.id,username:e.username,dialect:e.dialect,gender:e.gender,year:e.year}).select().single();if(o)throw o;return a}catch(a){alert(a.message)}},xe=async()=>{console.log("in getDialects");try{const{data:e,error:a}=await C.from("dialects").select("*");if(a){console.log("error:",a);return}else return e}catch(e){alert(e.message)}},he=async()=>{try{const{data:e,error:a}=await C.from("genders").select("*");if(a){console.log("error:",a);return}else return e}catch(e){alert(e.message)}};function Be(){const[e,a]=u.exports.useState(!0),[o,i]=u.exports.useState(!1),{session:d}=J(),{profile:r,setProfile:n}=ne(),{dialects:c,setDialects:p}=le(),{genders:f,setGenders:I}=de(),[g]=K(),$=ee();u.exports.useEffect(()=>{d?ve(d).then(t=>{t!==void 0&&t.length!==0?n(t[0]):console.log("no profile")}):$(`${S}/login`),c===void 0&&xe().then(t=>{t!==void 0&&p(t)}),f===void 0&&he().then(t=>{t!==void 0&&I(t)})},[]),u.exports.useEffect(()=>{f!==void 0&&c!==void 0&&r!==void 0&&a(!1)},[f,c,r]);const P=async()=>{d!==null?(a(!0),ye(r).then(()=>{i(!0),a(!1),g.get("origin")&&(window.location.href=`${S}${g.get("origin")}`)})):alert("not logged in")};return m(ae,{children:[m(h,{sx:{maxWidth:"sm",width:"100%"},children:[s(ie,{title:"Profile & Consent"}),s(h,{py:{sm:4,xs:2},children:s(te,{title:"Profile"})}),s(R,{m:2,children:s(h,{children:e?"Loading...":d?m(h,{children:[m(b,{container:!0,spacing:0,children:[s(b,{item:!0,xs:12,my:1,children:s(U,{fullWidth:!0,id:"username",label:"Username",name:"username",placeholder:"Your username",value:r.username!==void 0&&r.username!==null?r.username:"",onChange:t=>{n(l=>({...l,username:t.target.value}))}})}),s(b,{item:!0,xs:12,my:1,children:s(U,{fullWidth:!0,id:"year of birth",label:"Year of Birth",name:"year of birth",autoComplete:"year of birth",placeholder:"Your year of birth",value:r.year!==void 0&&r.year!==null?r.year:"",onChange:t=>{n(l=>({...l,year:parseInt(t.target.value)}))}})}),s(b,{item:!0,xs:12,my:1,children:m(V,{fullWidth:!0,children:[s(L,{id:"demo-simple-select-label",children:"Dialect"}),s(T,{labelId:"dialect",id:"dialect",value:r.dialect!==void 0&&r.dialect!==null?r.dialect:"",label:"dialect",onChange:t=>{n(l=>({...l,dialect:t.target.value}))},children:c?c.map(t=>s(N,{value:t.id,children:t.name},t.id)):""})]})}),s(b,{item:!0,xs:12,my:1,children:m(V,{fullWidth:!0,children:[s(L,{id:"demo-simple-select-label",children:"Gender"}),s(T,{labelId:"gender",id:"gender",value:r.gender!==void 0&&r.gender!==null?r.gender:"",label:"gender",onChange:t=>{n(l=>({...l,gender:t.target.value}))},children:f?f.map(t=>s(N,{value:t.id,children:t.name},t.id)):null})]})})]}),s(R,{sx:{width:"100%"},children:s(se,{onClick:P,variant:"contained",sx:{mt:3,mb:2},disabled:e,children:"Update profile"})})]}):s("p",{children:"not logged in"})})})]}),o&&s(re,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:s(oe,{title:"Profile Updated",description:"Thank you for providing this information :-)",condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{i(!1)}})})]})}export{Be as default};
