import{a as s,V as o,j as a}from"./setPrototypeOf.fd4aa278.js";import{s as P,p as A,as as H,au as Y,av as j,aa as U,b as V,a as E,aw as N,H as q,B as m,A as J,C as $,G as h,ab as K,at as v,ax as x,ay as b,az as y,ac as O,T as C,aA as Q,v as R,aB as X,L as Z,aC as ee,ae}from"./App.2ce1fde7.js";import{M as re}from"./Meta.0345d5b2.js";import"./index.fdd525af.js";import"./index.module.01fcbc19.js";const le=async l=>{console.log("profile:",l);try{const{data:n,error:d}=await P.from("profiles").upsert({id:l.id,username:l.username,dialect:l.dialect,gender:l.gender,year:l.year}).select().single();if(d)throw d;return n}catch(n){alert(n.message)}},te=async()=>{console.log("in getDialects");try{const{data:l,error:n}=await P.from("dialects").select("*");if(n){console.log("error:",n);return}else return l}catch(l){alert(l.message)}},ie=async()=>{try{const{data:l,error:n}=await P.from("genders").select("*");if(n){console.log("error:",n);return}else return l}catch(l){alert(l.message)}};function ue(){const[l,n]=s.exports.useState(!0),[d,S]=s.exports.useState(""),[D,w]=s.exports.useState(null),[F,L]=s.exports.useState(null),[G,k]=s.exports.useState(null),[M,B]=s.exports.useState(!1),{session:c}=A(),{profile:r,setProfile:u}=H(),{dialects:g,setDialects:W}=Y(),{genders:p,setGenders:_}=j(),[I]=s.exports.useState(Array.from({length:100},(e,i)=>1923+i)),[f]=U(),T=V(),{t}=E();s.exports.useEffect(()=>{c?N(c).then(e=>{e!==void 0&&e.length!==0?(u(e[0]),e[0].dialect&&L(e[0].dialect),e[0].gender&&k(e[0].gender),e[0].year&&w(e[0].year),e[0].username&&S(e[0].username)):console.log("no profile")}):f.get("origin")!==null?T(`/login?origin=${f.get("origin")}`):T("/login"),g===void 0&&te().then(e=>{e!==void 0&&W(e)}),p===void 0&&ie().then(e=>{e!==void 0&&_(e)})},[]),s.exports.useEffect(()=>{p!==void 0&&g!==void 0&&r!==void 0&&(n(!1),console.log("profile:",r))},[p,g,r]);const z=async()=>{c!==null&&r!==null?(n(!0),le(r).then(()=>{n(!1),f.get("origin")?window.location.href=`${ae}/${f.get("origin")}`:B(!0)})):alert("not logged in")};return o(q,{children:[o(m,{sx:{maxWidth:"sm",width:"100%"},children:[a(re,{title:"Profile & Consent"}),a(m,{py:{sm:4,xs:2},children:a(J,{title:t("infoHeader.home.profile.title"),description:t("infoHeader.home.profile.description")})}),a($,{m:2,children:a(m,{children:l?"Loading...":c?o(m,{width:360,children:[o(h,{container:!0,spacing:0,children:[a(h,{item:!0,xs:12,my:1,children:a(K,{fullWidth:!0,id:"username",label:t("pages.profile.username"),name:"username",placeholder:t("pages.profile.username"),value:r!==null&&r.username!==void 0&&r.username!==null?r.username:"",onChange:e=>{S(e.target.value),u(i=>({...i,username:e.target.value}))},helperText:d.length!==0&&d.length<3?t("pages.profile.minimumThreeLetters"):""})}),a(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[a(x,{id:"demo-simple-select-label",children:t("pages.profile.birthYear")}),a(b,{labelId:"birth year",id:"birth year",value:r!==null&&r.year!==void 0&&r.year!==null?r.year:"",label:t("pages.profile.birthYear"),onChange:e=>{w(e.target.value),u(i=>({...i,year:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:I?I.map(e=>a(y,{value:e,children:e},e)):""})]})}),a(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[a(x,{id:"demo-simple-select-label",children:t("pages.profile.dialect")}),a(b,{labelId:"dialect",id:"dialect",value:r!==null&&r.dialect!==void 0&&r.dialect!==null?r.dialect:"",label:t("pages.profile.dialect"),onChange:e=>{L(e.target.value),u(i=>({...i,dialect:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:g?g.map(e=>{var i;return a(y,{value:e.id,children:t(`pages.profile.${(i=e.name)==null?void 0:i.toLowerCase()}`)},e.id)}):""})]})}),a(h,{item:!0,xs:12,my:1,children:o(v,{fullWidth:!0,children:[a(x,{id:"demo-simple-select-label",children:t("pages.profile.gender")}),a(b,{labelId:"gender",id:"gender",value:r!==null&&r.gender!==void 0&&r.gender!==null?r.gender:"",label:"gender",onChange:e=>{k(e.target.value),u(i=>({...i,gender:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:p?p.map(e=>{var i;return a(y,{value:e.id,children:t(`pages.profile.${(i=e.name)==null?void 0:i.toLowerCase()}`)},e.id)}):null})]})})]}),a($,{sx:{width:"100%"},children:a(O,{onClick:z,variant:"contained",sx:{mt:3,mb:2},disabled:l||d.length<3||D===null||G===null||F===null,children:t("pages.profile.save")})}),r!==null&&r.over_16===!1&&o(m,{mt:2,children:[a(C,{fontWeight:"bold",align:"center",children:"Parent/Caregiver Details:"}),a(C,{align:"center",children:`name: ${r.parent_caregiver_name}`}),a(C,{align:"center",children:`email: ${r.parent_caregiver_email}`})]})]}):a("p",{children:"not logged in"})})})]}),M&&a(Q,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:c?a(R,{title:t("pages.profile.updated"),description:t("pages.profile.thanks"),condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{B(!1)}}):a(X,{component:Z,to:"/login",size:"medium",edge:"end",sx:{color:"primary.main"},"aria-label":"log in",children:a(ee,{})})})]})}export{ue as default};
