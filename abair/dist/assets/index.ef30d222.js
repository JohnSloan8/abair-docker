import{a as g,V as n,j as r}from"./setPrototypeOf.fd4aa278.js";import{s as C,p as F,ao as G,av as M,aw as W,aa as _,c as z,u as A,ax as T,H as $,B as m,A as Y,C as B,G as h,ab as j,ap as v,ay as b,az as x,aA as y,ac as H,T as P,aB as U,v as V,aC as E,L as N,aD as q,ae as J}from"./App.bffb0f55.js";import{M as K}from"./Meta.76ecbf21.js";import"./index.608f81c6.js";import"./index.module.01fcbc19.js";const O=async l=>{console.log("profile:",l);try{const{data:i,error:p}=await C.from("profiles").upsert({id:l.id,username:l.username,dialect:l.dialect,gender:l.gender,year:l.year}).select().single();if(p)throw p;return i}catch(i){alert(i.message)}},Q=async()=>{console.log("in getDialects");try{const{data:l,error:i}=await C.from("dialects").select("*");if(i){console.log("error:",i);return}else return l}catch(l){alert(l.message)}},R=async()=>{try{const{data:l,error:i}=await C.from("genders").select("*");if(i){console.log("error:",i);return}else return l}catch(l){alert(l.message)}};function le(){const[l,i]=g.exports.useState(!0),[p,S]=g.exports.useState(!1),{session:s}=F(),{profile:a,setProfile:o}=G(),{dialects:d,setDialects:I}=M(),{genders:c,setGenders:L}=W(),[w]=g.exports.useState(Array.from({length:100},(e,t)=>1923+t)),[f]=_(),k=z(),{t:u}=A();g.exports.useEffect(()=>{s?T(s).then(e=>{e!==void 0&&e.length!==0?o(e[0]):console.log("no profile")}):f.get("origin")!==null?k(`/login?origin=${f.get("origin")}`):k("/login"),d===void 0&&Q().then(e=>{e!==void 0&&I(e)}),c===void 0&&R().then(e=>{e!==void 0&&L(e)})},[]),g.exports.useEffect(()=>{c!==void 0&&d!==void 0&&a!==void 0&&(i(!1),console.log("profile:",a))},[c,d,a]);const D=async()=>{s!==null&&a!==null?(i(!0),O(a).then(()=>{i(!1),f.get("origin")?window.location.href=`${J}/${f.get("origin")}`:S(!0)})):alert("not logged in")};return n($,{children:[n(m,{sx:{maxWidth:"sm",width:"100%"},children:[r(K,{title:"Profile & Consent"}),r(m,{py:{sm:4,xs:2},children:r(Y,{title:"Profile"})}),r(B,{m:2,children:r(m,{children:l?"Loading...":s?n(m,{width:360,children:[n(h,{container:!0,spacing:0,children:[r(h,{item:!0,xs:12,my:1,children:r(j,{fullWidth:!0,id:"username",label:u("pages.profile.username"),name:"username",placeholder:"Your username",value:a!==null&&a.username!==void 0&&a.username!==null?a.username:"",onChange:e=>{o(t=>({...t,username:e.target.value}))}})}),r(h,{item:!0,xs:12,my:1,children:n(v,{fullWidth:!0,children:[r(b,{id:"demo-simple-select-label",children:"Birth Year"}),r(x,{labelId:"birth year",id:"birth year",value:a!==null&&a.year!==void 0&&a.year!==null?a.year:"",label:u("pages.profile.birthYear"),onChange:e=>{o(t=>({...t,year:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:w?w.map(e=>r(y,{value:e,children:e},e)):""})]})}),r(h,{item:!0,xs:12,my:1,children:n(v,{fullWidth:!0,children:[r(b,{id:"demo-simple-select-label",children:"Dialect"}),r(x,{labelId:"dialect",id:"dialect",value:a!==null&&a.dialect!==void 0&&a.dialect!==null?a.dialect:"",label:u("pages.profile.dialect"),onChange:e=>{o(t=>({...t,dialect:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:d?d.map(e=>r(y,{value:e.id,children:e.name},e.id)):""})]})}),r(h,{item:!0,xs:12,my:1,children:n(v,{fullWidth:!0,children:[r(b,{id:"demo-simple-select-label",children:"Gender"}),r(x,{labelId:"gender",id:"gender",value:a!==null&&a.gender!==void 0&&a.gender!==null?a.gender:"",label:"gender",onChange:e=>{o(t=>({...t,gender:e.target.value}))},inputProps:{MenuProps:{disableScrollLock:!0}},children:c?c.map(e=>r(y,{value:e.id,children:e.name},e.id)):null})]})})]}),r(B,{sx:{width:"100%"},children:r(H,{onClick:D,variant:"contained",sx:{mt:3,mb:2},disabled:l,children:"Update profile"})}),a!==null&&a.over_16===!1&&n(m,{mt:2,children:[r(P,{fontWeight:"bold",align:"center",children:"Parent/Caregiver Details:"}),r(P,{align:"center",children:`name: ${a.parent_caregiver_name}`}),r(P,{align:"center",children:`email: ${a.parent_caregiver_email}`})]})]}):r("p",{children:"not logged in"})})})]}),p&&r(U,{sx:{zIndex:9999,position:"fixed",top:"0",backgroundColor:"rgba(0,0,0,0.3)"},children:s?r(V,{title:u("pages.profile.updated"),description:u("pages.profile.thanks"),condition1:"",borderColor:"primary.main",buttons:[{text:"ok",color:"primary"}],onClick:()=>{S(!1)}}):r(E,{component:N,to:"/login",size:"medium",edge:"end",sx:{color:"primary.main"},"aria-label":"log in",children:r(q,{})})})]})}export{le as default};
