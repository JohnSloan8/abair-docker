import{L as m,j as o,W as x,a as _}from"./setPrototypeOf.d3c81777.js";import{u as Z,a as ee,b as te,c as se,R as ne,m as ae}from"./usePopulateVerbsTensesForms.b209e825.js";import{c as w,d as A,e as F,N as Q,a as V,f as oe,g as re,O as ie,P as le,Q as ce,R as ue,u as de,x as he,l as me,t as be,q as pe,S as ge,b as fe,M as Se}from"./index.53c496cd.js";import{s as q,m as ve,N as I,u as Te,a as B,b as D,B as h,T as k,A as xe,C as y}from"./App.9a35d506.js";import{b as ke}from"./index.67dc0a68.js";import{c as ye,S as Ce}from"./usePushRandomResponse.0fa8f669.js";import{u as M,b as _e,c as we,B as R}from"./index.89e190d9.js";import"./index.module.22f9f75f.js";import"./translationGA.387e9987.js";const Ae=async(a,n,r,s,e,t)=>{console.log("userID:",a);try{const{data:i,error:d}=await q.from("bat_chats").insert({user_id:a,verb:n,tense:r,form:s,questions:e,intro:t}).select("*").single();if(d)throw d;if(i)return i}catch(i){alert(i.message)}},Fe=async(a,n,r)=>{try{const{data:s,error:e}=await q.from("bat_questions").select("id").in("verb_id",a).in("tense_id",n).in("form_id",r);if(e)throw e;return s}catch(s){alert(s.message)}},Pe=()=>{const{profile:a}=ve(),{selectedVerb:n}=w(),{selectedTense:r}=A(),{selectedForm:s}=F(),e=ye();return()=>{let i=e([],"filler","intro","greeting","naive",{name:a!==null&&a.username!==null?a.username:"there"});return i=e(i,"filler","intro","taskDescription","basic",{verb:n!==void 0?n.name:"all verbs",tense:r!==void 0?r.name:"all tenses",form:s!==void 0?s.name:"all forms"}),i=e(i,"filler","intro","questionDescription","basic",{}),i=e(i,"filler","intro","getReady","basic",{}),i}},C=({label:a,value:n,handleChange:r,items:s,all:e=!0})=>m(Ce,{label:a,value:n,onChange:r,sx:{width:"100%",color:"#fff",textAlign:"center"},children:[e&&o(I,{value:"all",children:"all"},"all"),s.map((t,i)=>o(I,{value:t,children:t},i))]});function Ie(){const{selectedVerb:a}=w(),{selectedTense:n}=A(),{selectedForm:r}=F(),{setQuestionSet:s}=Q(),{verbs:e}=V(),{tenses:t}=oe(),{forms:i}=re();return()=>{const f=a!==void 0?[a.id]:e.map(u=>u.id),S=n!==void 0?[n.id]:t.map(u=>u.id),b=r!==void 0?[r.id]:i.map(u=>u.id);Fe(f,S,b).then(u=>{u!==void 0?s(u.map(p=>p.id)):console.log("question set undefined")})}}const Re=(a,n)=>{const r=new Array(n);let s=a.length;const e=new Array(s);for(n>s&&(n=s);n--;){const t=Math.floor(Math.random()*s);r[n]=a[t in e?e[t]:t],e[t]=--s in e?e[s]:s}return r},Qe=()=>{const a=x(ie),{selectedVerb:n,setSelectedVerb:r}=w(),s=x(le),{selectedTense:e,setSelectedTense:t}=A(),i=x(ce),{selectedForm:d,setSelectedForm:f}=F(),{noQuestions:S}=ue(),{questionSet:b}=Q(),[u,p]=_.exports.useState(!1),{chats:j,setChats:O}=M(),{setIntro:N}=_e(),{setOutro:H}=we(),E=Te(),{session:v}=B(),G=Ie(),W=Pe(),{setAdjacencyPairs:$}=de(),{setAnimatingOutro:z}=he(),L=()=>{v!==null&&(p(!0),G())},{setMessageInputDisabled:J}=me(),{t:g}=D(),{setShowAvailablePoints:K}=be(),{setShowPoints:U}=pe(),{setShowHome:X}=ge();return _.exports.useEffect(()=>{if(b.length!==0&&v!==null&&u){p(!1),U(!1),X(!1),K(!0),N([]),H([]),$([]),J(!0),z(!1);const l=W(),c=Re(b,S);if(c.length<10)if(c.length<5)alert("There are not enough questions in this question set. Please try another.");else{const Y=10-c.length;for(let T=0;T<Y;T++)c.push(c[T])}Ae(v.user.id,n!==void 0?n.name:null,e!==void 0?e.name:null,d!==void 0?d.name:null,c,l).then(P=>{O([...j,P]),E(`${ke}chat`)})}},[b]),m(R,{children:[m(h,{children:[o(k,{align:"center",variant:"h6",children:g("headers.verb")}),o(h,{border:1,borderColor:"primary.dark",borderRadius:1.5,children:o(C,{handleChange:l=>{r(a.find(c=>c.name===l.target.value))},value:n!==void 0?n.name:"all",label:"Verbs",items:a.map(l=>l.name)})})]}),m(h,{mt:1,children:[o(k,{align:"center",variant:"h6",children:g("headers.tense")}),o(h,{border:1,borderColor:"primary.dark",borderRadius:1.5,children:o(C,{handleChange:l=>{t(s.find(c=>c.name===l.target.value))},value:e!==void 0?e.name:"all",label:"Tenses",items:s.map(l=>l.name)})})]}),m(h,{mt:1,children:[o(k,{align:"center",variant:"h6",children:g("headers.form")}),o(h,{border:1,borderColor:"primary.dark",borderRadius:1.5,children:o(C,{handleChange:l=>{f(i.find(c=>c.name===l.target.value))},value:d!==void 0?d.name:"all",label:"Forms",items:i.map(l=>l.name)})})]}),o(h,{mt:3,children:o(R,{button:!0,width:"100%",children:o(xe,{size:"large",fullWidth:!0,label:g("buttons.start"),onClick:()=>{L()},selected:!0,color:"secondary"})})})]})},Ve=()=>{Z(),ee(),te();const{verbs:a}=V(),{chats:n}=M(),{session:r}=B(),s=se(),e=fe(),{t}=D();return _.exports.useEffect(()=>{a.length===0&&s(),n.length===0&&r!==null&&e(r.user.id)},[r]),m(h,{children:[o(Se,{title:"SetTask"}),o(y,{p:2,children:o(ne,{})}),o(y,{py:1,px:3,children:o(ae,{style:{whiteSpace:"pre-line",minHeight:130},sequence:[1e3,String(t("instructions.chooseTask.text_01")),200,String(t("instructions.chooseTask.text_02")),200,String(t("instructions.chooseTask.text_03")),500,String(t("instructions.chooseTask.text_04")),200,String(t("instructions.chooseTask.text_05")),200,String(t("instructions.chooseTask.text_06")),500,String(t("instructions.chooseTask.text_07")),500,String(t("instructions.chooseTask.text_08")),400,String(t("instructions.chooseTask.text_09")),400,String(t("instructions.chooseTask.text_10")),500,String(t("instructions.chooseTask.text_11"))],wrapper:"span",cursor:!0,repeat:0})}),o(y,{children:o(Qe,{})})]})},Ge=Ve;export{Ge as default};
