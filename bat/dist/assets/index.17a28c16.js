import{L as m,j as r,U as T,a as C}from"./setPrototypeOf.1b27e896.js";import{c as F,d as x,e as y,N as Q,a as R,f as J,g as K,O as X,P as Y,Q as Z,R as ee,u as se,l as te,t as ae,q as ne,S as oe,b as re,M as le}from"./index.bf9ca8b4.js";import{u as ie,a as ce,b as ue,c as de,R as me}from"./usePopulateVerbsTensesForms.2e7c980e.js";import{s as k,o as he,O as I,u as be,a as B,b as fe,B as b,T as w,A as pe,C as P}from"./App.b8dd3b56.js";import{b as ve}from"./index.3267a3cd.js";import{c as Se,S as ge}from"./usePushRandomResponse.373a29c5.js";import{u as D,b as Te,c as we,B as V}from"./index.65cd6306.js";import"./index.module.9b73f915.js";import"./translationGA.8e1c9285.js";const Ae=async(a,t,n,s,e,l)=>{console.log("userID:",a);try{const{data:o,error:u}=await k.from("bat_chats").insert({user_id:a,verb:t,tense:n,form:s,questions:e,intro:l}).select("*").single();if(u)throw u;if(o)return o}catch(o){alert(o.message)}},Ce=async(a,t,n)=>{try{const{data:s,error:e}=await k.from("bat_questions").select("id").in("verb_id",a).in("tense_id",t).in("form_id",n);if(e)throw e;return s}catch(s){alert(s.message)}},Fe=()=>{const{profile:a}=he(),{selectedVerb:t}=F(),{selectedTense:n}=x(),{selectedForm:s}=y(),e=Se();return()=>{let o=e([],"filler","intro","greeting","naive",{name:a!==null&&a.username!==null?a.username:"there"});return o=e(o,"filler","intro","taskDescription","basic",{verb:t!==void 0?t.name:"all verbs",tense:n!==void 0?n.name:"all tenses",form:s!==void 0?s.name:"all forms"}),o=e(o,"filler","intro","questionDescription","basic",{}),o=e(o,"filler","intro","getReady","basic",{}),o}},A=({label:a,value:t,handleChange:n,items:s,all:e=!0})=>m(ge,{label:a,value:t,onChange:n,sx:{width:"100%",color:"#fff",textAlign:"center"},children:[e&&r(I,{value:"all",children:"all"},"all"),s.map((l,o)=>r(I,{value:l,children:l},o))]});function xe(){const{selectedVerb:a}=F(),{selectedTense:t}=x(),{selectedForm:n}=y(),{setQuestionSet:s}=Q(),{verbs:e}=R(),{tenses:l}=J(),{forms:o}=K();return()=>{const v=a!==void 0?[a.id]:e.map(c=>c.id),S=t!==void 0?[t.id]:l.map(c=>c.id),h=n!==void 0?[n.id]:o.map(c=>c.id);Ce(v,S,h).then(c=>{console.log("q_s:",c),c!==void 0?s(c.map(f=>f.id)):console.log("question set undefined")})}}const ye=(a,t)=>{const n=new Array(t);let s=a.length;const e=new Array(s);for(t>s&&(t=s);t--;){const l=Math.floor(Math.random()*s);n[t]=a[l in e?e[l]:l],e[l]=--s in e?e[s]:s}return n},Ie=()=>{const a=T(X),{selectedVerb:t,setSelectedVerb:n}=F(),s=T(Y),{selectedTense:e,setSelectedTense:l}=x(),o=T(Z),{selectedForm:u,setSelectedForm:v}=y(),{noQuestions:S}=ee(),{questionSet:h}=Q(),[c,f]=C.exports.useState(!1),{chats:M,setChats:_}=D(),{setIntro:j}=Te(),{setOutro:O}=we(),q=be(),{session:g}=B(),N=xe(),E=Fe(),{setAdjacencyPairs:G}=se(),H=()=>{g!==null&&(f(!0),N())},{setMessageInputDisabled:$}=te(),{t:p}=fe(),{setShowAvailablePoints:z}=ae(),{setShowPoints:L}=ne(),{setShowHome:U}=oe();return C.exports.useEffect(()=>{if(h.length!==0&&g!==null&&c){f(!1),L(!1),U(!1),z(!0),j([]),O([]),G([]),$(!0);const i=E(),d=ye(h,S);Ae(g.user.id,t!==void 0?t.name:null,e!==void 0?e.name:null,u!==void 0?u.name:null,d,i).then(W=>{_([...M,W]),q(`${ve}chat`)})}},[h]),m(V,{children:[m(b,{children:[r(w,{align:"center",variant:"h6",children:p("headers.verb")}),r(A,{handleChange:i=>{n(a.find(d=>d.name===i.target.value))},value:t!==void 0?t.name:"all",label:"Verbs",items:a.map(i=>i.name)})]}),m(b,{mt:1,children:[r(w,{align:"center",variant:"h6",children:p("headers.tense")}),r(A,{handleChange:i=>{l(s.find(d=>d.name===i.target.value))},value:e!==void 0?e.name:"all",label:"Tenses",items:s.map(i=>i.name)})]}),m(b,{mt:1,children:[r(w,{align:"center",variant:"h6",children:p("headers.form")}),r(A,{handleChange:i=>{v(o.find(d=>d.name===i.target.value))},value:u!==void 0?u.name:"all",label:"Forms",items:o.map(i=>i.name)})]}),r(b,{mt:3,children:r(V,{button:!0,width:"100%",children:r(pe,{size:"large",fullWidth:!0,label:p("buttons.start"),onClick:()=>{H()},selected:!0,color:"secondary"})})})]})},Pe=()=>{ie(),ce(),ue();const{verbs:a}=R(),{chats:t}=D(),{session:n}=B(),s=de(),e=re();return C.exports.useEffect(()=>{a.length===0&&s(),t.length===0&&n!==null&&e(n.user.id)},[n]),m(b,{children:[r(le,{title:"SetTask"}),r(P,{p:2,children:r(me,{})}),r(P,{children:r(Ie,{})})]})},Oe=Pe;export{Oe as default};
