import{L as m,j as a,W as x,a as C}from"./setPrototypeOf.d3c81777.js";import{u as Z,a as ee,b as te,c as se,R as ne,m as ae}from"./usePopulateVerbsTensesForms.86f82613.js";import{c as _,d as A,e as F,N as Q,a as V,f as oe,g as re,O as ie,P as le,Q as ce,R as ue,u as de,x as he,l as me,t as be,q as pe,S as ge,b as fe,M as Se}from"./index.ecbd487e.js";import{s as q,m as ve,N as I,u as Te,a as B,b as D,B as d,T as k,A as xe,C as y}from"./App.efd44bd4.js";import{b as ke}from"./index.712160c5.js";import{c as ye,S as we}from"./usePushRandomResponse.57c7924a.js";import{u as M,b as Ce,c as _e,B as R}from"./index.0c431426.js";import"./index.module.22f9f75f.js";import"./translationGA.8fe80c9d.js";const Ae=async(o,n,r,s,e,t)=>{console.log("userID:",o);try{const{data:i,error:h}=await q.from("bat_chats").insert({user_id:o,verb:n,tense:r,form:s,questions:e,intro:t}).select("*").single();if(h)throw h;if(i)return i}catch(i){alert(i.message)}},Fe=async(o,n,r)=>{try{const{data:s,error:e}=await q.from("bat_questions").select("id").in("verb_id",o).in("tense_id",n).in("form_id",r);if(e)throw e;return s}catch(s){alert(s.message)}},Pe=()=>{const{profile:o}=ve(),{selectedVerb:n}=_(),{selectedTense:r}=A(),{selectedForm:s}=F(),e=ye();return()=>{let i=e([],"filler","intro","greeting","naive",{name:o!==null&&o.username!==null?o.username:"there"});return i=e(i,"filler","intro","taskDescription","basic",{verb:n!==void 0?n.name:"all verbs",tense:r!==void 0?r.name:"all tenses",form:s!==void 0?s.name:"all forms"}),i=e(i,"filler","intro","questionDescription","basic",{}),i=e(i,"filler","intro","getReady","basic",{}),i}},w=({label:o,value:n,handleChange:r,items:s,all:e=!0})=>m(we,{label:o,value:n,onChange:r,sx:{width:"100%",color:"#fff",textAlign:"center"},children:[e&&a(I,{value:"all",children:"all"},"all"),s.map((t,i)=>a(I,{value:t,children:t},i))]});function Ie(){const{selectedVerb:o}=_(),{selectedTense:n}=A(),{selectedForm:r}=F(),{setQuestionSet:s}=Q(),{verbs:e}=V(),{tenses:t}=oe(),{forms:i}=re();return()=>{const f=o!==void 0?[o.id]:e.map(u=>u.id),S=n!==void 0?[n.id]:t.map(u=>u.id),b=r!==void 0?[r.id]:i.map(u=>u.id);Fe(f,S,b).then(u=>{u!==void 0?s(u.map(p=>p.id)):console.log("question set undefined")})}}const Re=(o,n)=>{const r=new Array(n);let s=o.length;const e=new Array(s);for(n>s&&(n=s);n--;){const t=Math.floor(Math.random()*s);r[n]=o[t in e?e[t]:t],e[t]=--s in e?e[s]:s}return r},Qe=()=>{const o=x(ie),{selectedVerb:n,setSelectedVerb:r}=_(),s=x(le),{selectedTense:e,setSelectedTense:t}=A(),i=x(ce),{selectedForm:h,setSelectedForm:f}=F(),{noQuestions:S}=ue(),{questionSet:b}=Q(),[u,p]=C.exports.useState(!1),{chats:j,setChats:O}=M(),{setIntro:N}=Ce(),{setOutro:H}=_e(),E=Te(),{session:v}=B(),G=Ie(),W=Pe(),{setAdjacencyPairs:$}=de(),{setAnimatingOutro:z}=he(),L=()=>{v!==null&&(p(!0),G())},{setMessageInputDisabled:J}=me(),{t:g}=D(),{setShowAvailablePoints:K}=be(),{setShowPoints:U}=pe(),{setShowHome:X}=ge();return C.exports.useEffect(()=>{if(b.length!==0&&v!==null&&u){p(!1),U(!1),X(!1),K(!0),N([]),H([]),$([]),J(!0),z(!1);const l=W(),c=Re(b,S);if(c.length<10)if(c.length<5)alert("There are not enough questions in this question set. Please try another.");else{const Y=10-c.length;for(let T=0;T<Y;T++)c.push(c[T])}Ae(v.user.id,n!==void 0?n.name:null,e!==void 0?e.name:null,h!==void 0?h.name:null,c,l).then(P=>{O([...j,P]),E(`${ke}chat`)})}},[b]),m(R,{children:[m(d,{children:[a(k,{align:"center",variant:"h6",children:g("headers.verb")}),a(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:a(w,{handleChange:l=>{r(o.find(c=>c.name===l.target.value))},value:n!==void 0?n.name:"all",label:"Verbs",items:o.map(l=>l.name)})})]}),m(d,{mt:1,children:[a(k,{align:"center",variant:"h6",children:g("headers.tense")}),a(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:a(w,{handleChange:l=>{t(s.find(c=>c.name===l.target.value))},value:e!==void 0?e.name:"all",label:"Tenses",items:s.map(l=>l.name)})})]}),m(d,{mt:1,children:[a(k,{align:"center",variant:"h6",children:g("headers.form")}),a(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:a(w,{handleChange:l=>{f(i.find(c=>c.name===l.target.value))},value:h!==void 0?h.name:"all",label:"Forms",items:i.map(l=>l.name)})})]}),a(d,{mt:3,children:a(R,{button:!0,width:"100%",children:a(xe,{size:"large",fullWidth:!0,label:g("buttons.start"),onClick:()=>{L()},selected:!0,color:"secondary"})})})]})},Ve=()=>{Z(),ee(),te();const{verbs:o}=V(),{chats:n}=M(),{session:r}=B(),s=se(),e=fe(),{t}=D();return C.exports.useEffect(()=>{o.length===0&&s(),n.length===0&&r!==null&&e(r.user.id)},[r]),m(d,{children:[a(Se,{title:"SetTask"}),a(y,{p:2,children:a(ne,{})}),a(y,{py:1,children:a(d,{width:400,height:130,px:2,children:a(ae,{style:{whiteSpace:"pre",minHeight:130,width:"100%"},sequence:[1e3,String(t("instructions.chooseTask.text_01")),200,String(t("instructions.chooseTask.text_02")),200,String(t("instructions.chooseTask.text_03")),500,String(t("instructions.chooseTask.text_04")),200,String(t("instructions.chooseTask.text_05")),200,String(t("instructions.chooseTask.text_06")),500,String(t("instructions.chooseTask.text_07")),500,String(t("instructions.chooseTask.text_08")),400,String(t("instructions.chooseTask.text_09")),400,String(t("instructions.chooseTask.text_10")),500,String(t("instructions.chooseTask.text_11"))],wrapper:"span",cursor:!0,repeat:0})})}),a(y,{children:a(Qe,{})})]})},Ge=Ve;export{Ge as default};
