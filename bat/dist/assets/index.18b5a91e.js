import{L as p,j as o,X as k,a as g}from"./setPrototypeOf.96237ccd.js";import{u as U,a as Y,b as Z,c as ee,R as se,m as te}from"./usePopulateVerbsTensesForms.7e3df0f0.js";import{u as ae,M as ne}from"./robot.ea5bc1fe.js";import{s as P,_ as oe,g as _,e as C,h as A,i as F,as as V,at as R,f as Q,j as re,k as ie,au as le,av as ce,aw as ue,ax as de,b as D,O as he,Q as me,u as pe,a as j,d as be,W as ge,H as fe,S as Se,P as ve,ay as Te,B as d,T as x,A as ke,C as w}from"./App.70c51b49.js";import{b as xe}from"./index.865b1d1e.js";import{c as we,S as ye}from"./usePushRandomResponse.07a0aa6c.js";import{B as I}from"./BatBox.a200b5a1.js";import"./index.module.99d47a0b.js";import"./translationGA.d0c5dff7.js";const _e=async(n,t,r,s,a,e)=>{console.log("userID:",n);try{const{data:l,error:i}=await P.from("bat_chats").insert({user_id:n,verb:t,tense:r,form:s,questions:a,intro:e}).select("*").single();if(i)throw i;if(l)return l}catch(l){alert(l.message)}},Ce=async(n,t,r)=>{try{const{data:s,error:a}=await P.from("bat_questions").select("id").in("verb_id",n).in("tense_id",t).in("form_id",r);if(a)throw a;return s}catch(s){alert(s.message)}},Ae=()=>{const{profile:n}=oe(),{selectedVerb:t}=_(),{t:r}=C(),{selectedTense:s}=A(),{selectedForm:a}=F(),e=we();return()=>{let i=e([],"filler","intro","greeting","naive",{name:n!==null&&n.username!==null?n.username:"there"});return i=e(i,"filler","intro","taskDescription","basic",{verb:t!==void 0?t.name:r("task.allVerbs"),tense:s!==void 0?s.name:r("task.allTenses"),form:a!==void 0?a.name:r("task.allForms")}),i=e(i,"filler","intro","questionDescription","basic",{}),i=e(i,"filler","intro","getReady","basic",{}),i}},y=({label:n,value:t,handleChange:r,items:s,all:a=!0,allDisplay:e=""})=>p(ye,{label:n,value:t,onChange:r,sx:{width:"100%",color:"#fff",textAlign:"center"},children:[a&&o(V,{value:"all",children:e},"all"),s.map((l,i)=>o(V,{value:l,children:l},i))]});function Fe(){const{selectedVerb:n}=_(),{selectedTense:t}=A(),{selectedForm:r}=F(),{setQuestionSet:s}=R(),{verbs:a}=Q(),{tenses:e}=re(),{forms:l}=ie();return()=>{const S=n!==void 0?[n.id]:a.map(u=>u.id),v=t!==void 0?[t.id]:e.map(u=>u.id),b=r!==void 0?[r.id]:l.map(u=>u.id);Ce(S,v,b).then(u=>{u!==void 0?s(u.map(f=>f.id)):console.log("question set undefined")})}}const Ve=(n,t)=>{const r=new Array(t);let s=n.length;const a=new Array(s);for(t>s&&(t=s);t--;){const e=Math.floor(Math.random()*s);r[t]=n[e in a?a[e]:e],a[e]=--s in a?a[s]:s}return r},Ie=()=>{const n=k(le),{selectedVerb:t,setSelectedVerb:r}=_(),s=k(ce),{selectedTense:a,setSelectedTense:e}=A(),l=k(ue),{selectedForm:i,setSelectedForm:S}=F(),{noQuestions:v}=de(),{questionSet:b}=R(),[u,f]=g.exports.useState(!1),{chats:B,setChats:M}=D(),{setIntro:O}=he(),{setOutro:q}=me(),H=pe(),{session:T}=j(),E=Fe(),G=Ae(),{setAdjacencyPairs:L}=be(),{setAnimatingOutro:N}=ge(),W=()=>{T!==null&&(f(!0),E())},{setMessageInputDisabled:$}=fe(),{t:h}=C(),{setShowAvailablePoints:z}=Se(),{setShowPoints:X}=ve(),{setShowHome:J}=Te();return g.exports.useEffect(()=>{if(b.length!==0&&T!==null&&u){f(!1),X(!1),J(!1),z(!0),O([]),q([]),L([]),$(!0),N(!1);const c=G(),m=Ve(b,v);_e(T.user.id,t!==void 0?t.name:null,a!==void 0?a.name:null,i!==void 0?i.name:null,m,c).then(K=>{M([...B,K]),H(`${xe}chat`)})}console.log("availableVerbs:",n)},[b]),p(I,{children:[p(d,{children:[o(x,{align:"center",variant:"h6",children:h("headers.verb")}),o(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:o(y,{handleChange:c=>{r(n.find(m=>m.name===c.target.value))},value:t!==void 0?t.name:"all",label:"Verbs",items:n.map(c=>c.name),allDisplay:h("task.allVerbs")})})]}),p(d,{mt:1,children:[o(x,{align:"center",variant:"h6",children:h("headers.tense")}),o(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:o(y,{handleChange:c=>{e(s.find(m=>m.name===c.target.value))},value:a!==void 0?a.name:"all",label:"Tenses",items:s.map(c=>c.name),allDisplay:h("task.allTenses")})})]}),p(d,{mt:1,children:[o(x,{align:"center",variant:"h6",children:h("headers.form")}),o(d,{border:2,borderColor:"primary.dark",borderRadius:1.5,children:o(y,{handleChange:c=>{S(l.find(m=>m.name===c.target.value))},value:i!==void 0?i.name:"all",label:"Forms",items:l.map(c=>c.name),allDisplay:h("task.allForms")})})]}),o(d,{mt:3,children:o(I,{button:!0,width:"100%",children:o(ke,{size:"large",fullWidth:!0,label:h("buttons.start"),onClick:()=>{W()},selected:!0,color:"secondary"})})})]})},Pe=()=>{U(),Y(),Z();const{verbs:n}=Q(),{chats:t}=D(),{session:r}=j(),s=ee(),a=ae(),{t:e,i18n:l}=C(),[i]=g.exports.useState(l.language);return g.exports.useEffect(()=>{n.length===0&&s(),t.length===0&&r!==null&&a(r.user.id)},[r]),g.exports.useEffect(()=>{l.language!==i&&window.location.reload()},[l.language]),p(d,{children:[o(ne,{title:"SetTask"}),o(w,{pt:2,children:o(se,{})}),o(w,{py:1,px:2,children:o(d,{width:400,height:170,px:1,children:o(te,{style:{whiteSpace:"pre-wrap",minHeight:170,width:"100%"},sequence:[1e3,String(e("instructions.chooseTask.text_01")),200,String(e("instructions.chooseTask.text_02")),200,String(e("instructions.chooseTask.text_03")),500,String(e("instructions.chooseTask.text_04")),200,String(e("instructions.chooseTask.text_05")),200,String(e("instructions.chooseTask.text_06")),500,String(e("instructions.chooseTask.text_07")),500,String(e("instructions.chooseTask.text_08")),400,String(e("instructions.chooseTask.text_09")),400,String(e("instructions.chooseTask.text_10")),500,String(e("instructions.chooseTask.text_11"))],wrapper:"span",cursor:!0,repeat:0})})}),o(w,{children:o(Ie,{})})]})},Ee=Pe;export{Ee as default};
